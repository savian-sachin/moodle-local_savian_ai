{"version":3,"file":"chat_history.min.js","sources":["../src/chat_history.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n\n/**\n * Savian AI Chat History Viewer (Teacher/Admin)\n *\n * @module     local_savian_ai/chat_history\n * @copyright  2025 Savian AI\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax'], function($, Ajax) {\n\n    var ChatHistory = function() {\n        this.courseId = null;\n    };\n\n    ChatHistory.prototype.init = function(params) {\n        this.courseId = params.courseid;\n\n        this.render();\n        this.loadConversations();\n        this.loadAnalytics();\n    };\n\n    ChatHistory.prototype.render = function() {\n        var html = `\n            <div class=\"savian-chat-history-viewer\">\n                <!-- Analytics Cards -->\n                <div class=\"row mb-4\">\n                    <div class=\"col-md-3\">\n                        <div class=\"card text-center\">\n                            <div class=\"card-body\">\n                                <div class=\"h2 mb-0 savian-text-primary\" id=\"stat-conversations\">-</div>\n                                <div class=\"text-muted small\">Conversations</div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-md-3\">\n                        <div class=\"card text-center\">\n                            <div class=\"card-body\">\n                                <div class=\"h2 mb-0 savian-text-primary\" id=\"stat-messages\">-</div>\n                                <div class=\"text-muted small\">Messages</div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-md-3\">\n                        <div class=\"card text-center\">\n                            <div class=\"card-body\">\n                                <div class=\"h2 mb-0 savian-text-primary\" id=\"stat-users\">-</div>\n                                <div class=\"text-muted small\">Active Users</div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-md-3\">\n                        <div class=\"card text-center\">\n                            <div class=\"card-body\">\n                                <div class=\"h2 mb-0 savian-text-primary\" id=\"stat-feedback\">-</div>\n                                <div class=\"text-muted small\">Positive Feedback</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Conversations Table -->\n                <div class=\"card\">\n                    <div class=\"card-header\">\n                        <h4 class=\"mb-0\">Student Conversations</h4>\n                    </div>\n                    <div class=\"card-body\">\n                        <div class=\"table-responsive\">\n                            <table class=\"table table-striped\" id=\"savian-conversations-table\">\n                                <thead>\n                                    <tr>\n                                        <th>Student</th>\n                                        <th>Messages</th>\n                                        <th>Last Active</th>\n                                        <th>Actions</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    <tr>\n                                        <td colspan=\"4\" class=\"text-center\">\n                                            <div class=\"spinner-border spinner-border-sm\"></div>\n                                        </td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        $('#chat-history-main').html(html);\n    };\n\n    ChatHistory.prototype.loadConversations = function() {\n        Ajax.call([{\n            methodname: 'local_savian_ai_list_conversations',\n            args: {courseid: this.courseId}\n        }])[0].done(function(response) {\n            if (response.success && response.data) {\n                var tbody = '';\n                response.data.forEach(function(conv) {\n                    var lastActive = new Date(conv.last_message_at * 1000).toLocaleString();\n                    tbody += `\n                        <tr>\n                            <td>User ${conv.user_id}</td>\n                            <td>${conv.message_count}</td>\n                            <td>${lastActive}</td>\n                            <td>\n                                <button class=\"btn btn-sm btn-primary savian-view-conversation\" data-conversation-id=\"${conv.id}\">\n                                    <i class=\"fa fa-eye\"></i> View\n                                </button>\n                            </td>\n                        </tr>\n                    `;\n                });\n\n                if (tbody === '') {\n                    tbody = '<tr><td colspan=\"4\" class=\"text-center text-muted\">No conversations yet</td></tr>';\n                }\n\n                $('#savian-conversations-table tbody').html(tbody);\n            }\n        }).fail(function(error) {\n            // eslint-disable-next-line no-console\n            console.error('Failed to load conversations:', error);\n        });\n    };\n\n    ChatHistory.prototype.loadAnalytics = function() {\n        // Load analytics stats\n        // This would call a backend method to get course chat statistics\n        // For now, showing placeholder values\n        $('#stat-conversations').text('0');\n        $('#stat-messages').text('0');\n        $('#stat-users').text('0');\n        $('#stat-feedback').text('0%');\n    };\n\n    return {\n        init: function(params) {\n            var history = new ChatHistory();\n            history.init(params);\n        }\n    };\n});\n"],"names":["define","$","Ajax","ChatHistory","courseId","prototype","init","params","courseid","render","loadConversations","loadAnalytics","html","call","methodname","args","this","done","response","success","data","tbody","forEach","conv","lastActive","Date","last_message_at","toLocaleString","user_id","message_count","id","fail","error","console","text"],"mappings":";;;;;;;AAcAA,sCAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,UAEpCC,YAAc,gBACTC,SAAW,aAGpBD,YAAYE,UAAUC,KAAO,SAASC,aAC7BH,SAAWG,OAAOC,cAElBC,cACAC,yBACAC,iBAGTR,YAAYE,UAAUI,OAAS,WAqE3BR,EAAE,sBAAsBW,wtGAG5BT,YAAYE,UAAUK,kBAAoB,WACtCR,KAAKW,KAAK,CAAC,CACPC,WAAY,qCACZC,KAAM,CAACP,SAAUQ,KAAKZ,aACtB,GAAGa,MAAK,SAASC,aACbA,SAASC,SAAWD,SAASE,KAAM,KAC/BC,MAAQ,GACZH,SAASE,KAAKE,SAAQ,SAASC,UACvBC,WAAa,IAAIC,KAA4B,IAAvBF,KAAKG,iBAAwBC,iBACvDN,sFAEmBE,KAAKK,0DACVL,KAAKM,gEACLL,qLAEsFD,KAAKO,mNAQ/F,KAAVT,QACAA,MAAQ,qFAGZpB,EAAE,qCAAqCW,KAAKS,WAEjDU,MAAK,SAASC,OAEbC,QAAQD,MAAM,gCAAiCA,WAIvD7B,YAAYE,UAAUM,cAAgB,WAIlCV,EAAE,uBAAuBiC,KAAK,KAC9BjC,EAAE,kBAAkBiC,KAAK,KACzBjC,EAAE,eAAeiC,KAAK,KACtBjC,EAAE,kBAAkBiC,KAAK,OAGtB,CACH5B,KAAM,SAASC,SACG,IAAIJ,aACVG,KAAKC"}