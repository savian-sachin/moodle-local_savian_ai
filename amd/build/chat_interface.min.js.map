{"version":3,"file":"chat_interface.min.js","sources":["../src/chat_interface.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n\n/**\n * Savian AI Full-Page Chat Interface\n *\n * @module     local_savian_ai/chat_interface\n * @copyright  2025 Savian AI\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax'], function($, Ajax) {\n\n    var ChatInterface = function() {\n        this.conversationId = null;\n        this.courseId = null;\n    };\n\n    ChatInterface.prototype.init = function(params) {\n        this.courseId = params.courseid || null;\n        this.conversationId = params.conversationid || null;\n        this.fullpage = params.fullpage || false;\n\n        this.render();\n        this.attachEvents();\n\n        // Load conversation if specified.\n        if (this.conversationId) {\n            this.loadConversation(this.conversationId);\n        }\n    };\n\n    ChatInterface.prototype.render = function() {\n        var html = `\n            <div class=\"savian-chat-fullpage\">\n                <div class=\"savian-chat-sidebar\">\n                    <div class=\"savian-sidebar-header\">\n                        <h4>Conversations</h4>\n                        <button class=\"btn btn-sm btn-savian\" id=\"new-conversation-btn\">\n                            <i class=\"fa fa-plus\"></i> New\n                        </button>\n                    </div>\n                    <div class=\"savian-conversation-list\" id=\"savian-conversation-list\">\n                        <div class=\"text-center p-3\">\n                            <div class=\"spinner-border spinner-border-sm\"></div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"savian-chat-main\">\n                    <div class=\"savian-chat-messages-container\" id=\"chat-messages-full\">\n                        <div class=\"savian-chat-message assistant\">\n                            <div class=\"savian-message-content\">\n                                Hi! I'm your AI assistant. Select a conversation or start a new one.\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"savian-chat-input-area\">\n                        <textarea\n                            id=\"chat-input-full\"\n                            class=\"form-control\"\n                            placeholder=\"Type your message...\"\n                            rows=\"3\"\n                        ></textarea>\n                        <button id=\"send-message-btn\" class=\"btn btn-savian mt-2\">\n                            <i class=\"fa fa-paper-plane\"></i> Send\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        $('#savian-chat-main').html(html);\n        this.loadConversationList();\n    };\n\n    ChatInterface.prototype.attachEvents = function() {\n        var self = this;\n\n        $('#send-message-btn').on('click', function() {\n            self.sendMessage();\n        });\n\n        $('#chat-input-full').on('keydown', function(e) {\n            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\n                e.preventDefault();\n                self.sendMessage();\n            }\n        });\n\n        $('#new-conversation-btn').on('click', function() {\n            self.startNewConversation();\n        });\n\n        // Click on conversation in sidebar.\n        $(document).on('click', '.savian-conversation-item', function() {\n            var convId = parseInt($(this).data('conversation-id'));\n            self.loadConversation(convId);\n            $('.savian-conversation-item').removeClass('active');\n            $(this).addClass('active');\n        });\n    };\n\n    ChatInterface.prototype.loadConversationList = function() {\n        Ajax.call([{\n            methodname: 'local_savian_ai_list_conversations',\n            args: {courseid: this.courseId || 0}\n        }])[0].done(function(response) {\n            // Response loaded successfully.\n            if (response.success && response.data) {\n                var html = '';\n                if (Array.isArray(response.data) && response.data.length > 0) {\n                    response.data.forEach(function(conv) {\n                        var title = conv.title || 'Conversation ' + conv.id;\n                        var time = new Date(conv.last_message_at * 1000).toLocaleString();\n                        html += `\n                            <div class=\"savian-conversation-item\" data-conversation-id=\"${conv.id}\">\n                                <div class=\"savian-conv-title\">${title}</div>\n                                <div class=\"savian-conv-meta\">\n                                    <small>${conv.message_count} messages â€¢ ${time}</small>\n                                </div>\n                            </div>\n                        `;\n                    });\n                }\n                var fallback = '<p class=\"text-muted p-3\">No conversations yet. Start chatting below!</p>';\n                $('#savian-conversation-list').html(html || fallback);\n            } else {\n                // eslint-disable-next-line no-console\n                console.error('Invalid response:', response);\n                $('#savian-conversation-list').html('<p class=\"text-muted p-3\">No conversations yet</p>');\n            }\n        }).fail(function(error) {\n            // eslint-disable-next-line no-console\n            console.error('Failed to load conversations:', error);\n            $('#savian-conversation-list').html('<p class=\"text-danger p-3\">Failed to load. Check console for details.</p>');\n        });\n    };\n\n    ChatInterface.prototype.loadConversation = function(conversationId) {\n        // Similar to chat_widget.js loadConversation\n        this.conversationId = conversationId;\n        // Implementation would load and display messages\n    };\n\n    ChatInterface.prototype.sendMessage = function() {\n        // Similar to chat_widget.js sendMessage\n        var message = $('#chat-input-full').val().trim();\n        if (!message) {\n            return;\n        }\n        // Implementation would send message and display response\n    };\n\n    ChatInterface.prototype.startNewConversation = function() {\n        this.conversationId = null;\n        var welcome = '<div class=\"savian-chat-message assistant\">' +\n            '<div class=\"savian-message-content\">' +\n            'Hi! I\\'m your AI tutor. How can I help you today?' +\n            '</div></div>';\n        $('#chat-messages-full').html(welcome);\n        $('.savian-conversation-item').removeClass('active');\n    };\n\n    return {\n        init: function(params) {\n            var chatInstance = new ChatInterface();\n            chatInstance.init(params);\n        }\n    };\n});\n"],"names":["define","$","Ajax","ChatInterface","conversationId","courseId","prototype","init","params","courseid","conversationid","fullpage","render","attachEvents","this","loadConversation","html","loadConversationList","self","on","sendMessage","e","key","ctrlKey","metaKey","preventDefault","startNewConversation","document","convId","parseInt","data","removeClass","addClass","call","methodname","args","done","response","success","Array","isArray","length","forEach","conv","title","id","time","Date","last_message_at","toLocaleString","message_count","console","error","fail","val","trim"],"mappings":";;;;;;;AAcAA,wCAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,UAEpCC,cAAgB,gBACXC,eAAiB,UACjBC,SAAW,aAGpBF,cAAcG,UAAUC,KAAO,SAASC,aAC/BH,SAAWG,OAAOC,UAAY,UAC9BL,eAAiBI,OAAOE,gBAAkB,UAC1CC,SAAWH,OAAOG,WAAY,OAE9BC,cACAC,eAGDC,KAAKV,qBACAW,iBAAiBD,KAAKV,iBAInCD,cAAcG,UAAUM,OAAS,WAyC7BX,EAAE,qBAAqBe,4xDAClBC,wBAGTd,cAAcG,UAAUO,aAAe,eAC/BK,KAAOJ,KAEXb,EAAE,qBAAqBkB,GAAG,SAAS,WAC/BD,KAAKE,iBAGTnB,EAAE,oBAAoBkB,GAAG,WAAW,SAASE,GAC3B,UAAVA,EAAEC,MAAoBD,EAAEE,SAAWF,EAAEG,WACrCH,EAAEI,iBACFP,KAAKE,kBAIbnB,EAAE,yBAAyBkB,GAAG,SAAS,WACnCD,KAAKQ,0BAITzB,EAAE0B,UAAUR,GAAG,QAAS,6BAA6B,eAC7CS,OAASC,SAAS5B,EAAEa,MAAMgB,KAAK,oBACnCZ,KAAKH,iBAAiBa,QACtB3B,EAAE,6BAA6B8B,YAAY,UAC3C9B,EAAEa,MAAMkB,SAAS,cAIzB7B,cAAcG,UAAUW,qBAAuB,WAC3Cf,KAAK+B,KAAK,CAAC,CACPC,WAAY,qCACZC,KAAM,CAAC1B,SAAUK,KAAKT,UAAY,MAClC,GAAG+B,MAAK,SAASC,aAEbA,SAASC,SAAWD,SAASP,KAAM,KAC/Bd,KAAO,GACPuB,MAAMC,QAAQH,SAASP,OAASO,SAASP,KAAKW,OAAS,GACvDJ,SAASP,KAAKY,SAAQ,SAASC,UACvBC,MAAQD,KAAKC,OAAS,gBAAkBD,KAAKE,GAC7CC,KAAO,IAAIC,KAA4B,IAAvBJ,KAAKK,iBAAwBC,iBACjDjC,0GACkE2B,KAAKE,iFAC9BD,oIAEpBD,KAAKO,qCAA4BJ,0HAO9D7C,EAAE,6BAA6Be,KAAKA,MADrB,kFAIfmC,QAAQC,MAAM,oBAAqBf,UACnCpC,EAAE,6BAA6Be,KAAK,yDAEzCqC,MAAK,SAASD,OAEbD,QAAQC,MAAM,gCAAiCA,OAC/CnD,EAAE,6BAA6Be,KAAK,iFAI5Cb,cAAcG,UAAUS,iBAAmB,SAASX,qBAE3CA,eAAiBA,gBAI1BD,cAAcG,UAAUc,YAAc,WAEpBnB,EAAE,oBAAoBqD,MAAMC,QAO9CpD,cAAcG,UAAUoB,qBAAuB,gBACtCtB,eAAiB,KAKtBH,EAAE,uBAAuBe,KAJX,gJAKdf,EAAE,6BAA6B8B,YAAY,WAGxC,CACHxB,KAAM,SAASC,SACQ,IAAIL,eACVI,KAAKC"}