/**
 * Course content editor - View and Edit functionality for generated content
 *
 * @module     local_savian_ai/course_content_editor
 * @copyright  2025 Savian AI
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_savian_ai/course_content_editor",["jquery","core/modal","core/modal_save_cancel","core/modal_events","core/ajax","core/notification"],(function($,Modal,ModalSaveCancel,ModalEvents,Ajax,Notification){var courseStructure=null;return{init:function(){var $dataEl=$("#course-structure-data");if(0!==$dataEl.length){try{var structureData=$dataEl.attr("data-structure");if(!structureData)return void console.error("No course structure data found");courseStructure="string"==typeof structureData?JSON.parse(structureData):structureData}catch(e){return void console.error("Failed to parse course structure:",e)}$(document).on("click",'[data-action="view-item"]',(function(){!function(sectionIdx,itemIdx){var item=getItem(sectionIdx,itemIdx);if(!item)return;var content=getItemContent(item),icon=(type=item.type,{page:"üìÑ",activity:"üéØ",discussion:"üí¨",quiz:"‚ùì",assignment:"üìù"}[type]||"üìå"),defaultTitles={formative:"Self-Check Questions",page:"Content Page",activity:"Learning Activity",discussion:"Discussion Topic",quiz:"Section Quiz",assignment:"Assignment"},displayTitle=item.title||defaultTitles[item.type]||"Content";var type;Modal.create({title:icon+" "+displayTitle,body:'<div class="savian-content-preview p-3">'+content+"</div>",large:!0}).then((function(modal){return modal.show(),modal})).catch(Notification.exception)}($(this).data("section"),$(this).data("item"))})),$(document).on("click",'[data-action="edit-item"]',(function(){!function(sectionIdx,itemIdx){var item=getItem(sectionIdx,itemIdx);if(!item)return;var content=getItemContent(item),defaultTitles={formative:"Self-Check Questions",page:"Content Page",activity:"Learning Activity",discussion:"Discussion Topic",quiz:"Section Quiz",assignment:"Assignment"},displayTitle=item.title||defaultTitles[item.type]||"Content",bodyHtml='\n            <div class="form-group">\n                <label for="edit-title" class="font-weight-bold">Title:</label>\n                <input type="text" class="form-control" id="edit-title" value="'.concat(escapeHtml(displayTitle),'">\n            </div>\n            <div class="form-group">\n                <label for="edit-content" class="font-weight-bold">Content:</label>\n                <textarea class="form-control" id="edit-content" rows="15">').concat(escapeHtml(content),'</textarea>\n                <small class="form-text text-muted">You can edit the content before adding to the course.</small>\n            </div>\n        ');ModalSaveCancel.create({title:'<i class="fa fa-edit"></i> Edit: '+displayTitle,body:bodyHtml,large:!0}).then((function(modal){return modal.show(),modal.getRoot().on(ModalEvents.save,(function(){!function(sectionIdx,itemIdx,modal){var newTitle=$("#edit-title").val(),newContent=$("#edit-content").val(),item=getItem(sectionIdx,itemIdx);item&&(item.title=newTitle,"page"===item.type?item.content=newContent:"activity"===item.type?item.instructions=newContent:"discussion"===item.type?item.prompt=newContent:"formative"===item.type?item.content=newContent:"quiz"===item.type?item.description=newContent:"assignment"===item.type&&(item.instructions=newContent),Ajax.call([{methodname:"local_savian_ai_save_course_structure",args:{structure:JSON.stringify(courseStructure)}}])[0].done((function(){!function(sectionIdx,itemIdx,newTitle){$('[data-action="view-item"][data-section="'+sectionIdx+'"][data-item="'+itemIdx+'"]').closest(".list-group-item").find("span").first().text(newTitle)}(sectionIdx,itemIdx,newTitle),Notification.addNotification({message:"Changes saved successfully",type:"success"}),modal.hide()})).fail((function(error){Notification.exception(error)})))}(sectionIdx,itemIdx,modal)})),modal})).catch(Notification.exception)}($(this).data("section"),$(this).data("item"))})),$("#expand-all").on("click",(function(){$(".collapse").collapse("show"),$(this).blur()})),$("#collapse-all").on("click",(function(){$(".collapse").collapse("hide"),$(this).blur()}))}}};function getItem(sectionIdx,itemIdx){if(courseStructure&&courseStructure.sections&&courseStructure.sections[sectionIdx]){var section=courseStructure.sections[sectionIdx];if(section.content&&section.content[itemIdx])return section.content[itemIdx]}return null}function getItemContent(item){switch(item.type){case"page":default:return item.content||"";case"activity":return item.instructions||item.content||"";case"discussion":return item.prompt||item.content||"";case"formative":return function(formative){var html='<div class="alert alert-info">';html+="<h5>‚úì Knowledge Check (Ungraded)</h5>",formative.content&&(html+="<div>"+formative.content+"</div>");formative.questions&&formative.questions.length>0&&(html+="<p><strong>Self-assessment questions:</strong></p>",formative.questions.forEach((function(q,idx){html+='<div class="mb-3 p-2 bg-light rounded">',html+="<p><strong>Q"+(idx+1)+":</strong> "+escapeHtml(q.question)+"</p>",html+='<details><summary class="btn btn-sm btn-outline-primary">Show Answer</summary>',html+='<div class="alert alert-success mt-2 mb-0">'+escapeHtml(q.answer)+"</div>",html+="</details></div>"})));return html+="</div>"}(item);case"quiz":return function(quiz){var html="<p>"+(quiz.description||"")+"</p>";quiz.questions&&quiz.questions.length>0&&(html+="<h5>Questions ("+quiz.questions.length+"):</h5>",html+="<ol>",quiz.questions.forEach((function(q){html+="<li><strong>"+escapeHtml(q.question_text||q.text)+"</strong>",q.answers&&q.answers.length>0&&(html+='<ul class="mt-2">',q.answers.forEach((function(a){var correct=a.correct||1===a.fraction?" ‚úì <em>(Correct)</em>":"";html+="<li>"+escapeHtml(a.text)+correct+"</li>"})),html+="</ul>"),html+="</li>"})),html+="</ol>");return html}(item);case"assignment":return function(assignment){var html="<div>";html+="<h5>Instructions:</h5>",html+="<p>"+(assignment.instructions||assignment.content||"")+"</p>",assignment.rubric&&assignment.rubric.criteria&&(html+='<h5 class="mt-3">üìã Grading Rubric:</h5>',html+='<table class="table table-bordered table-sm">',html+='<thead class="thead-light"><tr><th>Criterion</th><th width="80">Points</th><th>Performance Levels</th></tr></thead>',html+="<tbody>",assignment.rubric.criteria.forEach((function(criterion){html+="<tr>",html+="<td><strong>"+escapeHtml(criterion.name)+"</strong></td>",html+='<td class="text-center">'+(criterion.points||"-")+"</td>",html+="<td>",criterion.levels&&criterion.levels.length>0?(html+='<ul class="list-unstyled mb-0">',criterion.levels.forEach((function(level){html+='<li class="mb-2">',html+='<span class="badge badge-secondary">'+level.score+" pts</span> ",html+=escapeHtml(level.description),html+="</li>"})),html+="</ul>"):html+=escapeHtml(criterion.description||""),html+="</td></tr>"})),html+="</tbody>",html+='<tfoot><tr><td colspan="2"><strong>Total Points</strong></td><td class="text-center"><strong>'+(assignment.rubric.total_points||100)+"</strong></td></tr></tfoot>",html+="</table>");return html+="</div>"}(item)}}function escapeHtml(text){if(!text)return"";var div=document.createElement("div");return div.textContent=text,div.innerHTML}}));

//# sourceMappingURL=course_content_editor.min.js.map